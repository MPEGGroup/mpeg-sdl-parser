import type { BuildContext } from "../util/build-context.ts";
import getLogger from "../../../util/logger.ts";
import { buildToken } from "../node/build-token.ts";
import { NodeKind } from "../../node/enum/node-kind.ts";
import { buildBinaryLiteral } from "../node/build-binary-literal.ts";
import { buildDecimalLiteral } from "../node/build-decimal-literal.ts";
import { buildFloatingPointLiteral } from "../node/build-floating-point-literal.ts";
import { buildHexadecimalLiteral } from "../node/build-hexadecimal-literal.ts";
import { buildIdentifier } from "../node/build-identifier.ts";
import { buildIntegerLiteral } from "../node/build-integer-literal.ts";
import type { AbstractNode } from "../../node/abstract-node.ts";

// Generated by Lezer from the SDL grammar
import * as TokenTypeId from "../../../lezer/parser.terms.ts";
import { InternalParseError } from "../../../parse-error.ts";

const logger = getLogger("consumePrimitive");

export function consumePrimitive(buildContext: BuildContext): AbstractNode {
  const { cursor } = buildContext;
  const currentState =
    buildContext.stateStack[buildContext.stateStack.length - 1];
  const token = buildToken(buildContext);

  let node: AbstractNode;

  switch (cursor.type.id) {
    case TokenTypeId.Identifier:
      node = buildIdentifier(token);
      break;
    case TokenTypeId.HexadecimalLiteral:
      node = buildHexadecimalLiteral(token);
      break;
    case TokenTypeId.IntegerLiteral:
      node = buildIntegerLiteral(token);
      break;
    case TokenTypeId.BinaryLiteral:
      node = buildBinaryLiteral(token);
      break;
    case TokenTypeId.DecimalLiteral:
      node = buildDecimalLiteral(token);
      break;
    case TokenTypeId.FloatingPointLiteral:
      node = buildFloatingPointLiteral(token);
      break;
    default:
      throw new InternalParseError(
        `Unsupported primitive type: ${cursor.type.name}`,
      );
  }
  logger.debug(
    currentState.indent + "consumed primitive node: " +
      NodeKind[node.nodeKind] +
      " " +
      token.text.replaceAll("\n", "\\n"),
  );

  return node;
}
